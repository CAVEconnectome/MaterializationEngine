<div class="card">
  <div class="card-header">
      <h2>Step 4: Process Data</h2>
  </div>

      <!-- Processing Status -->
      <div class="mb-4">
          <h4>Processing Status</h4>
          <div class="alert"
               :class="{
                   'alert-info': $store.processor.state.status === 'preparing',
                   'alert-primary': $store.processor.state.status === 'processing',
                   'alert-success': $store.processor.state.status === 'completed',
                   'alert-danger': $store.processor.state.status === 'error'
               }">
              <div class="d-flex align-items-center">
                  <!-- Processing Spinner -->
                  <div x-show="['preparing', 'processing'].includes($store.processor.state.status)" 
                       class="spinner-border spinner-border-sm me-2" 
                       role="status"
                       x-cloak>
                      <span class="visually-hidden">Processing...</span>
                  </div>
                  
                  <!-- Status Messages -->
                  <span x-show="$store.processor.state.status === 'preparing'" x-cloak>
                      Preparing to process data...
                  </span>
                  <span x-show="$store.processor.state.status === 'processing'" x-cloak>
                      Processing data...
                  </span>
                  <span x-show="$store.processor.state.status === 'completed'" x-cloak>
                      Processing completed successfully!
                  </span>
                  <span x-show="$store.processor.state.status === 'error'" x-cloak>
                      Error processing data
                  </span>
              </div>
          </div>
      </div>

      <!-- Progress Information -->
      <div x-show="['processing', 'completed'].includes($store.processor.state.status)" 
           class="mb-4"
           x-cloak>
          <div class="progress mb-2">
              <div class="progress-bar" 
                   role="progressbar" 
                   :style="`width: ${$store.processor.state.progress}%`"
                   :aria-valuenow="$store.processor.state.progress"
                   aria-valuemin="0" 
                   aria-valuemax="100">
                  <span x-text="$store.processor.state.progress + '%'"></span>
              </div>
          </div>
          <div class="text-muted small">
              <div>Processed Rows: <span x-text="$store.processor.state.processedRows"></span></div>
              <div>Total Rows: <span x-text="$store.processor.state.totalRows"></span></div>
              <div>Current Chunk: <span x-text="$store.processor.state.currentChunk"></span></div>
          </div>
      </div>

      <!-- Error Display -->
      <div x-show="$store.processor.state.error" class="mb-4" x-cloak>
          <div class="alert alert-danger">
              <h5 class="alert-heading">Processing Error</h5>
              <p x-text="$store.processor.state.error" class="mb-0"></p>
          </div>
      </div>

      <!-- Processing Results -->
      <div x-show="$store.processor.state.status === 'completed'" class="mb-4" x-cloak>
          <h4>Processing Results</h4>
          <div class="table-responsive">
              <table class="table table-bordered">
                  <tbody>
                      <tr>
                          <th>Input File</th>
                          <td x-text="$store.processor.state.inputFile"></td>
                      </tr>
                      <tr>
                          <th>Output File</th>
                          <td x-text="$store.processor.state.outputFile"></td>
                      </tr>
                      <tr>
                          <th>Total Rows Processed</th>
                          <td x-text="$store.processor.state.processedRows"></td>
                      </tr>
                      <tr>
                          <th>Processing Time</th>
                          <td x-text="$store.processor.state.processingTime"></td>
                      </tr>
                  </tbody>
              </table>
          </div>
      </div>

  <div class="card-footer">
      <div class="d-flex justify-content-between">
          <button class="btn btn-secondary" 
                  @click="$store.wizard.prev()"
                  :disabled="['preparing', 'processing'].includes($store.processor.state.status)">
              ‚Üê Back
          </button>
          <div>
              <button class="btn btn-warning me-2" 
                      @click="$store.processor.reset()"
                      :disabled="['preparing', 'processing'].includes($store.processor.state.status)">
                  Reset
              </button>
              <button class="btn btn-primary"
                      @click="$store.processor.state.status === 'idle' ? $store.processor.startProcessing() : $store.wizard.next()"
                      :disabled="['preparing', 'processing'].includes($store.processor.state.status)"
                      x-text="$store.processor.state.status === 'completed' ? 'Finish' : 'Start Processing'">
              </button>
          </div>
      </div>
  </div>
</div>